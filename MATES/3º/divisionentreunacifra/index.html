<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Divisiones</title>
    <!-- Cargamos React y Tailwind directamente desde Internet -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONOS SVG (Para no depender de librerÃ­as externas) ---
        const Calculator = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="14"/><line x1="12" x2="12" y1="14" y2="14"/><line x1="8" x2="8" y1="14" y2="14"/><line x1="16" x2="16" y1="18" y2="18"/><line x1="12" x2="12" y1="18" y2="18"/><line x1="8" x2="8" y1="18" y2="18"/></svg>
        );
        const ArrowRight = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        );
        const RefreshCw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const Check = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 6 9 17l-5-5"/></svg>
        );
        const X = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        // --- COMPONENTE PRINCIPAL (LÃ“GICA DEL JUEGO) ---
        function App() {
            const [problems, setProblems] = React.useState([]);
            const [currentProblemIndex, setCurrentProblemIndex] = React.useState(0);
            const [gameState, setGameState] = React.useState('intro'); 
            const [feedback, setFeedback] = React.useState(null); 
            const [score, setScore] = React.useState(0);
            const [selection, setSelection] = React.useState(0); // 0: nada, 1: 1 cifra, 2: 2 cifras

            const [inputs, setInputs] = React.useState({
                q1: '', q2: '', q3: '',
                r1: '', d2_down: '',
                r2: '', d3_down: '',
                r3: '',
            });

            React.useEffect(() => {
                generateProblems();
            }, []);

            const generateProblems = () => {
                const newProblems = [];
                while (newProblems.length < 5) {
                    const divisor = Math.floor(Math.random() * 8) + 2; 
                    const digit1 = Math.floor(Math.random() * (9 - divisor + 1)) + divisor;
                    const digit2 = Math.floor(Math.random() * 10);
                    const digit3 = Math.floor(Math.random() * 10);
                    
                    const dividend = digit1 * 100 + digit2 * 10 + digit3;

                    newProblems.push({ dividend, divisor, d1: digit1, d2: digit2, d3: digit3 });
                }
                setProblems(newProblems);
            };

            const startGame = () => {
                setScore(0);
                setCurrentProblemIndex(0);
                setGameState('playing');
                resetInputs();
            };

            const resetInputs = () => {
                setInputs({ q1: '', q2: '', q3: '', r1: '', d2_down: '', r2: '', d3_down: '', r3: '' });
                setFeedback(null);
                setSelection(0); // Reiniciar selecciÃ³n de arco
            };

            const handleInputChange = (field, value) => {
                if (feedback === 'correct') return;
                if (value && !/^\d+$/.test(value)) return;
                setInputs(prev => ({ ...prev, [field]: value }));
            };

            const checkAnswer = () => {
                const p = problems[currentProblemIndex];
                const step1_q = Math.floor(p.d1 / p.divisor);
                const step1_r = p.d1 % p.divisor;
                
                const num2 = step1_r * 10 + p.d2;
                const step2_q = Math.floor(num2 / p.divisor);
                const step2_r = num2 % p.divisor;
                
                const num3 = step2_r * 10 + p.d3;
                const step3_q = Math.floor(num3 / p.divisor);
                const step3_r = num3 % p.divisor;

                const isCorrect = 
                    parseInt(inputs.q1) === step1_q &&
                    parseInt(inputs.q2) === step2_q &&
                    parseInt(inputs.q3) === step3_q &&
                    parseInt(inputs.r1) === step1_r &&
                    parseInt(inputs.d2_down) === p.d2 &&
                    parseInt(inputs.r2) === step2_r &&
                    parseInt(inputs.d3_down) === p.d3 &&
                    parseInt(inputs.r3) === step3_r;

                if (isCorrect) {
                    setFeedback('correct');
                    setScore(s => s + 1);
                } else {
                    setFeedback('incorrect');
                }
            };

            const nextProblem = () => {
                if (currentProblemIndex < problems.length - 1) {
                    setCurrentProblemIndex(prev => prev + 1);
                    resetInputs();
                } else {
                    setGameState('finished');
                }
            };

            // CÃ¡lculos para la prueba
            const p = problems[currentProblemIndex] || {};
            const currentQuotientStr = `${inputs.q1}${inputs.q2}${inputs.q3}`;
            const proofQuotient = parseInt(currentQuotientStr) || 0;
            const proofRemainder = parseInt(inputs.r3) || 0;
            const proofMult = p.divisor * proofQuotient;
            const proofResult = proofMult + proofRemainder;

            const CellInput = ({ field, placeholder, className = "" }) => (
                <input
                    type="text"
                    maxLength="1"
                    value={inputs[field]}
                    onChange={(e) => handleInputChange(field, e.target.value)}
                    className={`w-12 h-12 sm:w-14 sm:h-14 text-center text-2xl font-bold border-2 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all z-10 relative
                        ${feedback === 'correct' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300'}
                        ${feedback === 'incorrect' ? 'border-red-300 bg-red-50' : 'bg-white'}
                        ${className}`}
                    placeholder={placeholder}
                />
            );

            if (gameState === 'intro') {
                return (
                    <div className="min-h-screen bg-indigo-50 flex flex-col items-center justify-center p-4 font-sans text-gray-800">
                        <div className="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-4 border-indigo-100">
                            <div className="bg-indigo-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                                <Calculator size={48} className="text-indigo-600" />
                            </div>
                            <h1 className="text-3xl font-black text-gray-800 mb-3">DivisiÃ³n Maestra</h1>
                            <p className="text-gray-600 mb-6 leading-relaxed">
                                Resuelve 5 divisiones. Si lo haces bien, verÃ¡s la prueba de la divisiÃ³n automÃ¡ticamente.
                            </p>
                            
                            <div className="mb-8 p-4 bg-amber-50 border-l-4 border-amber-400 text-amber-700 rounded-r-lg font-bold text-lg shadow-sm">
                                ðŸ’¡ Elige 1 o 2 cifras del dividendo para comenzar
                            </div>

                            <button onClick={startGame} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2 text-lg">
                                Comenzar Reto <ArrowRight size={24} />
                            </button>
                        </div>
                    </div>
                );
            }

            if (gameState === 'finished') {
                return (
                    <div className="min-h-screen bg-indigo-50 flex flex-col items-center justify-center p-4">
                        <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full text-center">
                            <h2 className="text-3xl font-black text-gray-800 mb-4">Â¡Resultado Final!</h2>
                            <div className="text-7xl font-black text-indigo-600 mb-2">{score}/5</div>
                            <div className="w-full bg-gray-200 rounded-full h-4 mb-6">
                                <div className="bg-indigo-600 h-4 rounded-full transition-all duration-1000" style={{width: `${(score/5)*100}%`}}></div>
                            </div>
                            <button onClick={() => { generateProblems(); startGame(); }} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transition-all">
                                <RefreshCw size={20} /> Jugar Otra Vez
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center py-6 px-2 sm:px-4 font-sans">
                    <div className="w-full max-w-3xl flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div className="flex items-center gap-3">
                            <span className="bg-indigo-100 text-indigo-800 text-sm font-bold px-4 py-1.5 rounded-full uppercase tracking-wider">
                                Ronda {currentProblemIndex + 1} / 5
                            </span>
                        </div>
                        <div className="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-lg border border-slate-200">
                            <span className="text-slate-500 text-sm font-bold uppercase">Aciertos</span>
                            <span className="text-green-600 font-black text-xl">{score}</span>
                        </div>
                    </div>

                    <div className="bg-white p-4 sm:p-8 rounded-2xl shadow-xl w-full max-w-3xl flex flex-col items-center border border-slate-200">
                        <div className="mb-8 p-4 bg-white rounded-xl overflow-x-auto w-full flex justify-center">
                            <div className="grid grid-cols-[60px_60px_60px_30px_auto] gap-y-3 text-3xl font-mono relative">
                                
                                {/* CAPA DE ARCO SUPERIOR (SVG) */}
                                <svg className="absolute top-0 left-0 w-full h-full pointer-events-none z-0" style={{top: '-15px'}}>
                                    {/* Arco para 1 cifra */}
                                    {selection === 1 && (
                                        <path d="M 15 25 Q 30 5 45 25" fill="none" stroke="#3b82f6" strokeWidth="4" strokeLinecap="round" />
                                    )}
                                    {/* Arco para 2 cifras */}
                                    {selection === 2 && (
                                        <path d="M 15 25 Q 60 -5 105 25" fill="none" stroke="#3b82f6" strokeWidth="4" strokeLinecap="round" />
                                    )}
                                </svg>

                                {/* Fila 1 - Dividendo y Divisor */}
                                {/* Primera cifra con evento click */}
                                <div 
                                    className="flex justify-center items-center h-16 font-bold text-slate-800 text-5xl cursor-pointer hover:bg-slate-50 rounded select-none relative z-10"
                                    onClick={() => setSelection(1)}
                                    title="Seleccionar 1 cifra"
                                >
                                    {p.d1}
                                </div>
                                {/* Segunda cifra con evento click */}
                                <div 
                                    className="flex justify-center items-center h-16 font-bold text-slate-800 text-5xl cursor-pointer hover:bg-slate-50 rounded select-none relative z-10"
                                    onClick={() => setSelection(2)}
                                    title="Seleccionar 2 cifras"
                                >
                                    {p.d2}
                                </div>
                                {/* Tercera cifra */}
                                <div className="flex justify-center items-center h-16 font-bold text-slate-800 text-5xl select-none">
                                    {p.d3}
                                </div>
                                <div></div>
                                <div className="flex items-center pl-6 border-l-4 border-b-4 border-slate-800 h-16 min-w-[180px]">
                                    <span className="font-bold text-5xl text-slate-800">{p.divisor}</span>
                                </div>

                                {/* Fila 2 */}
                                <div className="flex justify-center"><CellInput field="r1" placeholder="R" /></div>
                                <div className="flex justify-center"><CellInput field="d2_down" placeholder="â†“" className="bg-amber-50 border-amber-200 text-amber-800" /></div>
                                <div></div>
                                <div></div>
                                <div className="flex gap-2 pl-6 items-start min-w-[180px]">
                                    <CellInput field="q1" placeholder="C" className="bg-blue-50 border-blue-200 text-blue-900" />
                                    <CellInput field="q2" placeholder="C" className="bg-blue-50 border-blue-200 text-blue-900" />
                                    <CellInput field="q3" placeholder="C" className="bg-blue-50 border-blue-200 text-blue-900" />
                                </div>

                                {/* Fila 3 */}
                                <div></div>
                                <div className="flex justify-center"><CellInput field="r2" placeholder="R" /></div>
                                <div className="flex justify-center"><CellInput field="d3_down" placeholder="â†“" className="bg-amber-50 border-amber-200 text-amber-800" /></div>
                                <div className="col-span-2"></div>

                                {/* Fila 4 */}
                                <div></div>
                                <div></div>
                                <div className="flex justify-center relative flex-col items-center">
                                    <CellInput field="r3" placeholder="R" className="border-double border-4 border-slate-400" />
                                    <div className="absolute -bottom-5 text-slate-400 text-4xl select-none transform -rotate-90 pointer-events-none">)</div>
                                </div>
                                <div className="col-span-2"></div>
                            </div>
                        </div>

                        <div className="w-full max-w-sm mb-6">
                            {feedback === 'incorrect' && (
                                <div className="mb-4 flex items-center justify-center gap-2 text-red-600 bg-red-50 px-4 py-3 rounded-xl animate-bounce border border-red-100">
                                    <X size={24} />
                                    <span className="font-medium">Algo falla. Revisa tus cÃ¡lculos.</span>
                                </div>
                            )}
                            {feedback === 'correct' && (
                                <div className="mb-4 flex items-center justify-center gap-2 text-green-700 bg-green-50 px-4 py-3 rounded-xl animate-pulse border border-green-100">
                                    <Check size={24} />
                                    <span className="font-bold text-lg">Â¡Excelente! Correcto.</span>
                                </div>
                            )}

                            {feedback !== 'correct' ? (
                                <button onClick={checkAnswer} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95 text-lg flex justify-center items-center gap-2">
                                    <Check size={20} /> Comprobar Respuesta
                                </button>
                            ) : (
                                <button onClick={nextProblem} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all flex justify-center items-center gap-3 text-lg animate-in fade-in slide-in-from-bottom-2">
                                    {currentProblemIndex < 4 ? 'Siguiente DivisiÃ³n' : 'Ver Resultados Finales'} <ArrowRight size={24} />
                                </button>
                            )}
                        </div>

                        {feedback === 'correct' && (
                            <div className="w-full bg-slate-50 p-6 rounded-xl border border-slate-200 animate-in slide-in-from-top-4 fade-in duration-500">
                                <div className="flex items-center justify-between mb-4 border-b border-slate-200 pb-2">
                                    <div className="flex items-center gap-2">
                                        <div className="bg-indigo-100 p-1.5 rounded-md"><Calculator size={18} className="text-indigo-600"/></div>
                                        <h3 className="text-sm uppercase tracking-wider text-slate-500 font-bold">Prueba AutomÃ¡tica</h3>
                                    </div>
                                    <span className="text-xs text-slate-400 font-mono">D = d Ã— c + r</span>
                                </div>
                                <div className="flex flex-col gap-4 items-center text-lg text-slate-700">
                                    <div className="flex flex-wrap items-center gap-2 sm:gap-4 justify-center bg-white px-6 py-4 rounded-lg shadow-sm border border-slate-100 w-full">
                                        <div className="flex items-center gap-2">
                                            <div className="flex flex-col items-center">
                                                <span className="text-[10px] text-slate-400 uppercase">Divisor</span>
                                                <span className="font-bold text-2xl text-slate-800">{p.divisor}</span>
                                            </div>
                                            <span className="text-slate-400 text-sm">x</span>
                                            <div className="flex flex-col items-center">
                                                <span className="text-[10px] text-slate-400 uppercase">Cociente</span>
                                                <span className="font-bold text-2xl text-blue-600">{proofQuotient}</span>
                                            </div>
                                            <span className="text-slate-300 text-sm">=</span>
                                            <span className="text-slate-500 font-medium">{proofMult}</span>
                                        </div>
                                        <div className="flex items-center gap-2 border-l border-slate-200 pl-4">
                                            <span className="text-slate-400 text-sm">+</span>
                                            <div className="flex flex-col items-center">
                                                <span className="text-[10px] text-slate-400 uppercase">Resto</span>
                                                <span className="font-bold text-2xl text-slate-500">{proofRemainder}</span>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2 border-l-2 border-slate-800 pl-4 ml-2">
                                            <span className="text-slate-400 text-sm">=</span>
                                            <span className="font-black text-3xl text-green-600">{proofResult}</span>
                                        </div>
                                    </div>
                                    <div className="text-green-600 text-sm font-bold flex items-center gap-2">
                                        <Check size={16}/> El resultado coincide con el dividendo ({p.dividend}).
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>