<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Multiplicar 4x2</title>
    <!-- Cargamos React, ReactDOM, Babel y Tailwind CSS desde servidores rápidos -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS para quitar las flechas de subir/bajar en los inputs numéricos */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-slate-100">
    <!-- Aquí es donde React montará la aplicación -->
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONOS SVG ---
        const Calculator = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="14"/><line x1="12" x2="12" y1="14" y2="14"/><line x1="8" x2="8" y1="14" y2="14"/><line x1="16" x2="16" y1="18" y2="18"/><line x1="12" x2="12" y1="18" y2="18"/><line x1="8" x2="8" y1="18" y2="18"/></svg>
        );
        const ArrowRight = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        );
        const RefreshCw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const Check = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 6 9 17l-5-5"/></svg>
        );
        const X = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        // --- LÓGICA DE LA APLICACIÓN ---
        function App() {
            const [problems, setProblems] = React.useState([]);
            const [currentProblemIndex, setCurrentProblemIndex] = React.useState(0);
            const [gameState, setGameState] = React.useState('intro'); // intro, playing, finished
            const [feedback, setFeedback] = React.useState(null); // 'correct', 'incorrect', null
            const [score, setScore] = React.useState(0);

            // Estado para los inputs del usuario (p1=producto unidades, p2=producto decenas, sum=total)
            // Indices: 0 es la derecha (unidades), aumentan hacia la izquierda
            const [inputs, setInputs] = React.useState({});

            React.useEffect(() => {
                generateProblems();
            }, []);

            const generateProblems = () => {
                const newProblems = [];
                while (newProblems.length < 5) {
                    // Generar Multiplicando (4 cifras: 1000-9999) y Multiplicador (2 cifras: 11-99)
                    const factor1 = Math.floor(Math.random() * 9000) + 1000;
                    const factor2 = Math.floor(Math.random() * 89) + 11;
                    newProblems.push({ factor1, factor2 });
                }
                setProblems(newProblems);
            };

            const startGame = () => {
                setScore(0);
                setCurrentProblemIndex(0);
                setGameState('playing');
                resetInputs();
            };

            const resetInputs = () => {
                setInputs({});
                setFeedback(null);
            };

            const handleInputChange = (key, value) => {
                if (feedback === 'correct') return;
                if (value !== '' && !/^\d$/.test(value)) return; // Solo 1 dígito
                setInputs(prev => ({ ...prev, [key]: value }));
            };

            // Convierte los inputs (ej: p1_2, p1_1, p1_0) en un número entero
            const getNumberFromInputs = (prefix, length) => {
                let str = '';
                for (let i = length; i >= 0; i--) {
                    const val = inputs[`${prefix}_${i}`] || '';
                    str += val;
                }
                return parseInt(str) || 0;
            };

            const checkAnswer = () => {
                const p = problems[currentProblemIndex];
                
                // Calcular respuestas correctas
                const unitMultiplier = p.factor2 % 10;
                const tenMultiplier = Math.floor(p.factor2 / 10);
                
                const expectedRow1 = p.factor1 * unitMultiplier; // Multiplicación de unidades
                const expectedRow2 = p.factor1 * tenMultiplier; // Multiplicación de decenas
                const expectedTotal = p.factor1 * p.factor2;    // Suma total

                // Obtener respuestas del usuario
                const userRow1 = getNumberFromInputs('p1', 5);
                const userRow2 = getNumberFromInputs('p2', 5);
                const userSum = getNumberFromInputs('sum', 6);

                const isCorrect = (userRow1 === expectedRow1) && 
                                  (userRow2 === expectedRow2) && 
                                  (userSum === expectedTotal);

                if (isCorrect) {
                    setFeedback('correct');
                    setScore(s => s + 1);
                } else {
                    setFeedback('incorrect');
                }
            };

            const nextProblem = () => {
                if (currentProblemIndex < problems.length - 1) {
                    setCurrentProblemIndex(prev => prev + 1);
                    resetInputs();
                } else {
                    setGameState('finished');
                }
            };

            // Componente para una celda de input individual
            const DigitInput = ({ id, className = "", disabled = false }) => (
                <input
                    type="text"
                    maxLength="1"
                    disabled={disabled}
                    value={inputs[id] || ''}
                    onChange={(e) => handleInputChange(id, e.target.value)}
                    className={`w-10 h-12 sm:w-12 sm:h-14 text-center text-xl sm:text-2xl font-bold border-2 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all
                        ${feedback === 'correct' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300'}
                        ${feedback === 'incorrect' ? 'border-red-300 bg-red-50' : 'bg-white'}
                        ${disabled ? 'bg-slate-200 border-slate-300 text-slate-400 cursor-not-allowed' : ''}
                        ${className}`}
                />
            );

            // Preparar dígitos para visualización
            const p = problems[currentProblemIndex];
            const f1_digits = p ? p.factor1.toString().split('').map(Number) : [];
            const f2_digits = p ? p.factor2.toString().split('').map(Number) : [];

            // --- VISTA: PANTALLA DE INICIO ---
            if (gameState === 'intro') {
                return (
                    <div className="min-h-screen bg-indigo-50 flex flex-col items-center justify-center p-4 font-sans text-gray-800">
                        <div className="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-4 border-indigo-100">
                            <div className="bg-indigo-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                                <Calculator size={48} className="text-indigo-600" />
                            </div>
                            <h1 className="text-2xl font-black text-gray-800 mb-2">Multiplicación Experta</h1>
                            <p className="text-gray-600 mb-8 leading-relaxed">
                                Resuelve 5 multiplicaciones de 4 cifras por 2 cifras.
                                <br/><span className="text-sm font-bold text-indigo-600">¡Cuidado con el hueco de las decenas!</span>
                            </p>
                            <button onClick={startGame} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2 text-lg">
                                Comenzar <ArrowRight size={24} />
                            </button>
                        </div>
                    </div>
                );
            }

            // --- VISTA: PANTALLA FINAL ---
            if (gameState === 'finished') {
                return (
                    <div className="min-h-screen bg-indigo-50 flex flex-col items-center justify-center p-4">
                        <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full text-center">
                            <h2 className="text-3xl font-black text-gray-800 mb-4">¡Resultado Final!</h2>
                            <div className="text-7xl font-black text-indigo-600 mb-2">{score}/5</div>
                            <div className="w-full bg-gray-200 rounded-full h-4 mb-6">
                                <div className="bg-indigo-600 h-4 rounded-full transition-all duration-1000" style={{width: `${(score/5)*100}%`}}></div>
                            </div>
                            <p className="text-slate-500 mb-6">{score === 5 ? '¡Perfecto! Eres un genio.' : '¡Bien hecho! Sigue practicando.'}</p>
                            <button onClick={() => { generateProblems(); startGame(); }} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transition-all">
                                <RefreshCw size={20} /> Jugar Otra Vez
                            </button>
                        </div>
                    </div>
                );
            }

            // --- VISTA: JUEGO ---
            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center py-6 px-2 sm:px-4 font-sans">
                    {/* Cabecera */}
                    <div className="w-full max-w-xl flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div className="flex items-center gap-3">
                            <span className="bg-indigo-100 text-indigo-800 text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full uppercase tracking-wider">
                                Ronda {currentProblemIndex + 1} / 5
                            </span>
                        </div>
                        <div className="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-lg border border-slate-200">
                            <span className="text-slate-500 text-xs sm:text-sm font-bold uppercase">Aciertos</span>
                            <span className="text-green-600 font-black text-xl">{score}</span>
                        </div>
                    </div>

                    <div className="bg-white p-4 sm:p-8 rounded-2xl shadow-xl w-full max-w-xl flex flex-col items-center border border-slate-200">
                        
                        {/* Grid de Multiplicación */}
                        <div className="mb-8 p-4 bg-white rounded-xl overflow-x-auto w-full flex justify-center">
                            <div className="grid grid-cols-7 gap-x-2 gap-y-3 text-2xl sm:text-3xl font-mono relative">
                                
                                {/* FILA 1: Multiplicando */}
                                <div></div><div></div><div></div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f1_digits[0]}</div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f1_digits[1]}</div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f1_digits[2]}</div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f1_digits[3]}</div>

                                {/* FILA 2: Multiplicador */}
                                <div className="flex justify-end items-center pr-2 text-slate-400 font-bold text-xl"></div>
                                <div></div><div></div><div></div>
                                <div className="flex justify-end items-center pr-2 text-slate-400 font-bold text-xl">x</div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f2_digits[0]}</div>
                                <div className="flex justify-center items-center h-14 font-bold text-slate-800">{f2_digits[1]}</div>

                                {/* LÍNEA SEPARADORA */}
                                <div className="col-span-7 border-b-4 border-slate-800 -mt-2 mb-2"></div>

                                {/* FILA 3: Producto Unidades (p1) */}
                                <div></div><div></div>
                                <DigitInput id="p1_4" />
                                <DigitInput id="p1_3" />
                                <DigitInput id="p1_2" />
                                <DigitInput id="p1_1" />
                                <DigitInput id="p1_0" className="bg-blue-50 border-blue-200 text-blue-900" />

                                {/* FILA 4: Producto Decenas (p2) - DESPLAZADO */}
                                <div></div>
                                <DigitInput id="p2_4" />
                                <DigitInput id="p2_3" />
                                <DigitInput id="p2_2" />
                                <DigitInput id="p2_1" />
                                <DigitInput id="p2_0" className="bg-blue-50 border-blue-200 text-blue-900" />
                                {/* Hueco bloqueado */}
                                <div className="w-10 h-12 sm:w-12 sm:h-14 flex items-center justify-center bg-slate-200 rounded text-slate-400 font-bold border-2 border-slate-300">-</div>

                                {/* LÍNEA SEPARADORA SUMA */}
                                <div className="col-span-7 border-b-4 border-slate-300 -mt-2 mb-2 relative">
                                    <span className="absolute left-2 -top-5 text-2xl font-bold text-slate-400">+</span>
                                </div>

                                {/* FILA 5: Suma Final */}
                                <DigitInput id="sum_6" />
                                <DigitInput id="sum_5" />
                                <DigitInput id="sum_4" />
                                <DigitInput id="sum_3" />
                                <DigitInput id="sum_2" />
                                <DigitInput id="sum_1" />
                                <DigitInput id="sum_0" className="border-4 border-double border-slate-400" />
                            </div>
                        </div>

                        {/* Botones y Feedback */}
                        <div className="w-full max-w-sm mb-6">
                            {feedback === 'incorrect' && (
                                <div className="mb-4 flex items-center justify-center gap-2 text-red-600 bg-red-50 px-4 py-3 rounded-xl animate-bounce border border-red-100">
                                    <X size={24} />
                                    <span className="font-medium text-sm">Revisa las multiplicaciones o la suma.</span>
                                </div>
                            )}
                            {feedback === 'correct' && (
                                <div className="mb-4 flex items-center justify-center gap-2 text-green-700 bg-green-50 px-4 py-3 rounded-xl animate-pulse border border-green-100">
                                    <Check size={24} />
                                    <span className="font-bold text-lg">¡Excelente! Correcto.</span>
                                </div>
                            )}

                            {feedback !== 'correct' ? (
                                <button onClick={checkAnswer} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95 text-lg flex justify-center items-center gap-2">
                                    <Check size={20} /> Comprobar
                                </button>
                            ) : (
                                <button onClick={nextProblem} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all flex justify-center items-center gap-3 text-lg animate-in fade-in slide-in-from-bottom-2">
                                    {currentProblemIndex < 4 ? 'Siguiente Operación' : 'Ver Resultados'} <ArrowRight size={24} />
                                </button>
                            )}
                        </div>
                        
                        <div className="text-center text-xs text-slate-400 mt-2">
                            Tip: Si la casilla no necesita número, déjala vacía.
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>